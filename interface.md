# 接口文档规范

## 重要更新

接口文档撰写和交互 **不再使用** Markdown文档或者Confluence系统，而是采用[RAP](https://github.com/thx/RAP)系统，[RAP](https://github.com/thx/RAP)包含接口管理，接口自动化，MOCK数据生成，自动化测试等功能。

## 简介

该文档主要的设计目标是规范项目的接口文档撰写格式的**规范性和一致性**。

更多设计规范的细节请参考Confluence中的《REST API 设计规范》文档。

## 约定

+ **[应该]** 采用RESTful的接口风格；
+ **[应该]** 采用JSON格式传递数据。

## 命名规则

* 接口 **[应该]** 按照业务`模块`来组织，每一个业务`模块`下有0至多个`页面`，`页面`是逻辑页面，比如单页应用每一个View都可以算做一个页面，每个`页面`下有0至多个`请求`，每个`请求`即为接口。每个`请求`中有请求参数列表和响应参数列表；
* URL、参数、返回值中的单词 **[应该]** 采取**小写**，复合词采取**下划线**分开的**全小写命名**；
* 将接口的版本号放在URL中，比如：`//ip:<port>/v1/user/1`。


## 接口版本

每一个接口的起始版本为`v0.0.0.1`，从左到右分别为：主版本号，副版本号1，副版本号2，副版本号3。他们的更新约定如下：

* 在每次新建接口和开发过程中，**[应该]** 根据修改范围大小，只更新`副版本号2`或`副版本号3`；
* 在开发过程中如果接口发生重大变更，或开发完毕提交测试后接口发生变更，**[应该]** 只更新`副版本号1`；
* 在第一次正式发布后，**[应该]** 更新`主版本号`，从0更新为1；
* 以后每一次需求变更，需要修改接口时，**[应该]** 根据`副版本号`和接口内容更新的情况，权衡是否更新`主版本号`。原则为：**如果接口已经不能向前兼容，则 [必须] 更新`主版本号`，否则，视情况而定**；
* 接口的URL中应该只包含`主版本号`，比如：`/v1/user/1`、`/v2/user/1`；
* 第一次正式发布之前和之后，不论`主版本号`是0还是1，URL均使用`v1`；
* 为了保证兼容，每一次更新`主版本号`，不能覆盖修改之前版本的接口！除非保证所有使用此接口的系统均已改动。

## 元素

接口文档中每一个接口 **[应该]** 包含如下元素：

* 接口名称
* 请求URL
* 接口描述
* 请求方法（请求类型）：`GET` / `POST` / `PUT` / `DELETE`
* 参数列表，包含：
  * 参数名称
  * 参数含义
  * 参数类型
  * 参数描述：是否必须、默认值、规格和约束等 
* 响应参数列表，包含：
  * 参数名称
  * 参数含义
  * 参数类型
  * 参数描述：默认值、规格和约束、情境等 


## 常见参数约定

一些常见的参数命名及含义如下：

* `token`: 加密标识；
* `page`：从第几页开始，用于分页；
* `per_page`：每一页记录数量，用于分页；
* `limit`：指定返回记录数量；
* `offset`：指定返回记录的开始位置；
* `sortby`：指定排序字段；
* `order`： 指定排序方式：`asc`-正序，`desc`-逆序；


## 返回值格式约定

返回值 **[应该]** 采用`JSON`格式，`JSON`格式可以使用[在线编辑器](https://www.jsoneditoronline.org/)。

返回值 **[应该]** 符合以下规范：

* `GET`: `/collection`：返回资源对象的列表（数组）
* `GET`: `/collection/resource`：返回单个资源对象
* `POST`: `/collection`：返回新生成的资源对象
* `PUT`: `/collection/resource`：返回完整的资源对象
* `DELETE`: `/collection/resource`：返回一个空文档

返回值 **[必须]** 包含如下字段：

* `success`: `类型 boolean`。请求是否成功。正常返回，值为`true`；发生错误，值为`false`
* `error`: `类型 object`。错误信息。如果发生错误，`success`应为`false`，返回值 **[应该]** 包含`error`对象，`error`对象包含如下属性：
  * `code`: `类型 string`。错误编码
  * `msg`: `类型 string`。错误信息
* `result`: `类型 object`。返回结果信息。

`error`对象中的`code`和`msg`有全局的通用约定，也可能有每个接口的特殊约定。**[建议]** 特殊取值写在每一个接口返回值说明中。

 **[建议]** 在Confluence中单独建立《错误码信息》文档，便于迅速查阅所有通用约定的错误码，可以参考[《微信全局返回码说明》](http://mp.weixin.qq.com/wiki/17/fa4e1434e57290788bde25603fa2fcbd.html)。


## 示例（更多标准示例请参考 `RAP系统`）

### 获取用户信息

#### 接口说明

获取用户的基本信息。

#### URL

```
//ip:<port>/v1/user
```

#### 参数说明

| 名称 | 类型 | 是否必须 | 默认值 | 描述 |
|---|---|---|---|---|
| token | boolean | 是 | 无 | 加密标识 |
| id | number | 是 | 无 | 用户ID |

#### 返回值示例

```json
{
  "success": true,
  "result": {
    "username": "jnoodle",
    "age": 30,
    "sex": 1,
    "desp": "一个脱离了低级趣味的人",
  }
}
```

#### 返回值说明

| 名称 | 类型 | 描述 |
|---|---|---|---|---|
| username | string | 用户名 |
| age | number | 年龄 |
| sex | number | 性别，0-女；1-男；2-未知 |
| desp | string | 简介 |



















