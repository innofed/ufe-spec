# 目录结构规范

## 简介

该文档主要的设计目标是实现项目**目录结构的一致性**，容易理解并方便构建与管理。

### 规范说明约定

以下规范文档中：

* 项目包含但不限于微信、移动和互联网项目；
* `${root}`表示项目的根目录。

### 资源分类

资源分成两大类：

1. 源代码资源：指开发者编写的源代码，包括`js`、`html`、`css`、`template`等；
2. 内容资源：指希望做为内容提供给访问者的资源，包括`图片`、`字体`、`flash`、`pdf`等。


## 目录命名原则

* 简洁：使用习惯性缩写的单词， **[必须]** 采用容易理解的缩写，并做到尽量简洁。如：源代码目录使用`src`，不使用`source`。下面是更多例子：
  * `img`：图片。 **[不允许]** 使用`image`、`images`、`imgs`等；
  * `js`：javascript脚本。 **[不允许]** 使用`script`、`scripts`等；
  * `css`：样式表。 **[不允许]** 使用`style`、`styles`等；
  * `tpl`：模板文件。 **[不允许]** 使用`template`、`tmpl`等；
  * `src`：源文件目录。 **[不允许]** 使用`source`等；
  * `dep`：引入的第三方依赖包目录。 **[不允许]** 使用`lib`、`library`、`dependency`等；
  * `dist`：发布目录。 **[不允许]** 使用`distribute`、`distribution`等；
  * `swf`：flash。 **[不允许]** 使用`flash`等；
*  **[必须]** 使用单数形式， **[不允许]** 使用复数形式。如：`imgs`、`docs`是不被允许的。


## 目录划分

在`${root}`下，目录结构 **[必须]** 按照`职能`进行划分（也就是说：一级目录 **[必须]** 具有某种**职能属性**），[不允许]将资源类型或业务逻辑划分的目录直接置于`${root}`下。

常用的目录有`src`、`doc`、`dep`、`test`、`dist`等。常见的目录结构为:


```
${root}/
    ├── README.md
    ├── .editorconfig
    ├── src/
	    ├── vendor/
	        ├── zepto/
	        ├── requirejs/
	        └── ...
	    ├── lib/
	        ├── tree/
	        ├── menu/
	        └── ...
        ├── common/
            ├── biz1/
                ├── subbiz1/
                    ├── list.js
                    ├── list.tpl.html
                    ├── list.css
                    └── ...
                ├── subbiz2/
                └── ...
        ├── biz2/
            ├── css/
                ├── add.css
                ├── edit.css
                └── remove.css
            ├── img/
                └── add_button.png
            ├── tpl/
                ├── add.html
                └── edit.html
            ├── remove.html
            ├── add.js
            ├── edit.js
            ├── remove.js
            └── ...
        └── ...
    ├── node_modules/
        ├── gulp/
        ├── path/
        └── ...
    ├── build/
    ├── test/
    ├── entry/
        ├── biz1.html
        ├── biz2.html
        └── ...
    ├── dist/
    ├── doc/
        ├── api
        └── ...
    └── ...
```

###  README.md

每个项目都 **[必须]** 包含一个`README.md`文件，此文件中 **[应该]** 概要描述此项目的功能和特点等信息。

### .editorconfig

每个项目 **[应该]** 包含`.editorconfig`文件，用来统一配置编辑器的换行、缩进存储格式。

**什么是EditorConfig？**

[EditorConfig](http://editorconfig.org/)是用于帮助开发人员在各个IDE中统一代码格式的配置文件，比如统一在代码中使用空格而不是Tab。

**如何使用EditorConfig？**

首先去[EditorConfig](http://editorconfig.org/)下载不同编辑器下的支持插件，然后将这里的`.editorconfig`文件放到项目根目录。

### `src` 目录

项目中所有源码 **[必须]** 存放在此目录下。`src`目录内，绝大多数情况 **[应该]** 根据**`业务逻辑`**划分目录结构。划分出的子目录（比如例子中的`biz1`）我们称为**`业务目录`**。

`src`下 **[必须]** 只包含`业务目录`与`common目录`。业务公共资源 **[必须]** 命名为`common`。`common目录`做为业务公共资源的目录，也视如业务目录。

`src`目录在发布时 **[必须]** 被**删除**。

#### 业务目录划分原则

* JS资源 **[不允许]** 按资源类型划分目录， **[必须]** 按业务逻辑划分目录。JS资源应直接置于业务目录下。即：业务目录下 **[不允许]** 出现`js目录`；
* **除JS资源外**的源文件资源，当资源数量较多时，为方便管理， **[应该]** 按资源类型划分目录。即：业务目录下 **[允许]** 出现`css`、`tpl`等目录；
* 内容资源 **[应该]** 按资源类型划分目录。即：业务目录下 **[允许]** 出现`img`、`swf`、`font`目录；
* 业务目录中，如果文件太多不好管理，需要划分子目录时，也 **[必须]** 继续遵守根据业务逻辑划分的原则，划分子业务。如例子中的`subbiz1`；
* 通常，对于一个业务目录， **[应该]** 将业务相关的源文件资源都直接置于业务目录下；
* 业务目录下源文件资源数量较多时，我们第一直觉应该是：**是否业务划分不够细？是否应该划分子业务，建立子业务目录？**
* **包项目**是实现某个独立功能，有复用价值的代码集。按照通常的理解，一个包项目不应该特别复杂。包可视如一个不太复杂的业务，其`src`下的划分原则与业务项目的业务目录划分原则保持一致；
* `common目录`为业务公共目录，用于存放业务项目的业务公共文件。所以，根据`业务逻辑`划分目录结构时，业务逻辑命名 **[不允许]** 为`common`。


### `node_modules` 目录

`node_modules`目录用于存放项目依赖的NPM第三方包。该目录下的内容一般通过工具（npm）管理，普通开发人员 **[不允许]** 更改`node_modules `目录下第三方包的任何内容。

当项目需要引入的第三方代码时，第三方包应将源码直接置于`${root}/src/vendor`目录下，规则见该目录下的规定。

### `vendor` 目录

`vendor`目录用于存放引用的第三方的包/库，vendor下目录结构应包含包/库名称、版本、开发版（或发布版），例如。

```
vendor
 ├── zepto/
     └── 1.1.6/
         ├── zepto.js
         └── zepto.min.js
 ├── requirejs/
     └── 2.1.17/
         └── requirejs.js
 └── ...
```

### `lib` 目录

`lib`目录用于存放自主开发的包，或者进行修改过的第三方包/库。

更多关于包的内容请参考[包结构规范](package.md)。

### `build` 目录

`build`目录用于存放开发时或构建阶段使用的工具。该目录在发布时 **[必须]** 被**删除**。

### `test` 目录

`test`目录用于存放测试用例以及开发阶段的模拟数据。该目录在发布时 **[必须]** 被**删除**。

### `doc` 目录

`doc`目录用于存放`项目文档`。项目文档可能是开发者维护的文档，API文档，也可能是通过工具生成的文档。

`doc`目录下的`api`目录存放项目的API文档，详见[接口文档规范](interface.md)。

### `entry` 目录

`entry`目录用于存放项目的页面入口文件，通常是上线后可被直接访问的静态页面。

多页面项目通常页面入口文件较多， **[应该]** 统一放在`entry`目录中，按业务逻辑命名。

项目在发布的时候，构建工具可以页面入口文件为入口进行**分析和编译**。

多页面项目经过构建工具编译后，目录结构可能如下：

```
output
 ├── biz1/
     ├── dist/
         ├── js/
         ├── css/
         └── img/
     └── index.html
 ├── biz2/
     ├── dist/
         ├── js/
         ├── css/
         └── img/
     └── index.html
```

### `dist` 目录

`dist`目录用于存放用于线上访问的`静态资源`。

通常构建工具会对`src`目录和`dep`目录下的资源进行分析、合并与压缩等，生成到`dist`目录下。所以该目录尽量避免手工管理。下面是一个构建工具生成后的dist目录示例：

```
${root}
    ├── dist/
        ├── js/
            ├── loader.js
            └── build.js
        ├── css/
            ├── common.css
            └── img/
        ├── tpl/
            └── build.tpl.html
        ├── img/
        └── ...
```

### 资源目录

按资源类型命名的目录称作资源目录。资源目录 **[不允许]** 直接置于`${root}`下。

#### js

`js`目录可用于存放`js`资源文件（包含可编译成`js`的`coffeescript`、`typescript`等语言）。`js`文件后缀名 **[必须]** 为.js。

`js`目录内 **[必须]** 存放`js`资源文件，但`js`资源文件不一定存放于`js`目录下：

* 对于`src`目录，`js`资源文件 **[不允许]** 存放于`js`目录下。
* 对于`dist`目录，`js`资源文件 **[应该]** 存放于`js`目录下，视构建行为决定。
* 对于其他`一级目录`内，`js`资源文件 **[应该]** 不存放于`js`目录下。

#### css

`css`目录可用于存放`css资源文件`（包含`less`，`sass`等动态样式表语言）。`css`文件后缀名 **[必须]** 为.css，`less`文件后缀名 **[必须]** 为`.less`，`sass`文件后缀名 **[必须]** 为`.sass`。

`css`目录内 **[必须]** 存放`css`资源文件，但`css`资源文件不一定存放于`css`目录下：

* 对于`src`目录，`css`资源文件 **[应该]** 存放于`业务目录`下，也 **[允许]** 存放于`css`目录下。
* 对于`dist`目录，`css`资源文件 **[应该]** 存放于`css`目录下，视构建行为决定。
* 对于其他`一级目录`内，`css`资源文件 **[应该]** 不存放于`css`目录下。

关于css引用图片的位置说明，请参考[img](#imgdir)章节。


<a name="imgdir"></a>

#### img

`img`目录可用于存放`图片资源文件`。包括`页面直接引用`的图片与`css引用`图片。常见的图片资源有`gif/jpg/png/svg/bmp`等。

对于`css`引用的图片， **[必须]** 放在`./img`目录下，`.`代表当前`css`资源所在的目录。

对于`页面直接引用`的图片：

* 被多页面引用的图片 **[应该]** 放在`${root}/src/common/img`目录下。
* 单一页面引用的图片 **[应该]** 放在`./img`目录下，`.`代表当前页面所在的目录。


#### tpl

`tpl`目录可用于存放`template`资源文件。`template`资源文件后缀名 **[应该]** 为`.html`或`.tpl`。


#### font

`font`目录可用于存放字体资源文件。常见的字体资源有`tff/woff/svg`等。


#### swf

`swf`目录可用于存放`flash`资源文件。`flash`资源文件 **[不允许]** 置于`img`目录中。


### 其他

除了上面列举的一些常见目录和文件之外，`${root}`下面也可以放置一些跟项目发布相关的文件，例如`build.sh`，`build.xml`，`Makefile`，`Gruntfile`等等.
































